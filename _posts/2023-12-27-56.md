---
title: "[운영체제] 프로세스와 스레드(진행중)"
toc: true
toc_sticky: true
categories: 
    - 운영체제
tags:
    - 운영체제
    - CS
typora-root-url: ../

---

# 프로세스와 스레드

## 프로세스

프로세스는 실행 중인 프로그램을 말하며, 완전히 독립적이기 때문에 메모리 영역(Code, Data, Heap, Stack)을 다른 프로세스와 공유하지 않는다. 프로세스는 최소 1개의 스레드(메인 스레드)를 가지고 있다.

프로세스간 자원을 공유하지 않기 때문에 한 프로세스에서 오류가 발생해도 다른 프로세스에 영향을 주지 않는다.

### 프로세스의 종류

- 자식 프로세스 : fork를 통해 자식 프로세스를 만든 상태, 부모의 데이터, 힙, 스택, PCB를 복사한다.
- 데몬 프로세스 : 백그라운드에서 동작하며 특정한 서비스를 제공하는 프로세스를 말한다.
- 고아 프로세스 : 부모 프로세스가 먼저 종료되고 고립된 자식 프로세스를 말한다.
- 좀비 프로세스 : 자식 프로세스가 종료되었음에도 부모 프로세스로부터 작업 종료에 대한 승인을 받지 못한 프로세스를 말한다.

## 스레드

스레드는 프로세스 내에서 스택만 따로 가지고, 그 이외의 메모리 영역(Code, Data, Heap) 영역을 공유하기 때문에 다른 스레드의 실행 결과를 즉시 확인할 수 있다. 스레드는 프로세스 내에 존재하며 프로세스가 할당받은 자원을 이용하여 실행된다.

한 스레드에서 오류가 발생하면 나머지 프로세스 내의 스레드에 영향을 줄 수도 있다.

### 스레드마다 독립적으로 할당되는 자원

스레드는 독립적으로 **스택 영역**과 **PC 레지스터**를 가지고 있다. 독립적인 스택 영역을 가지는 이유는 스택 영역이 함수의 실행과 연관되어 있기 때문이다. 독립적으로 스택을 가진다는 의미는 곧 독립적으로 함수 호출이 가능하다는 것이다. 즉 프로세스 내에서 독립적인 실행 흐름을 만들기 위해서는 각 스레드마다 스택이 존재해야 한다.

독립적으로 PC 레지스터를 가지는 이유는 간단하다. PC 레지스터값에는 현재 스레드가 명령어를 어디까지 수행했는지가 저장되어 있다. 스레드는 CPU를 할당받았다가 스케줄러에 의해 선점당해 문맥교환을 하게 된다. 다시 해당 스레드가 실행될 때 어디까지 실행했는지를 알아야 하기 때문에 독립적인 PC 레지스터를 가져야 한다.

### 메모리 영역

1. 코드 영영(Code) : 실행할 프로그램의 코드가 저장되는 영역으로, 텍스트 영역이라고도 부른다. CPU는 해당 코드 영역에 저장된 명령어를 하나씩 가져가서 처리하게 된다.
2. 데이터 영역 (Data) : 전역 변수와 정적 변수가 저장되는 영역으로, 프로그램이 시작되는 동시에 할당되며, 프로그램이 종료되면 소멸하게 된다.
3. 힙 영역 (Heap) : 사용자가 직접 관리하는 영역이며 메모리 공간이 동적으로 할당 및 해제된다. 동적으로 할당되기 때문에 new로 생성한 오브젝트가 많아질수록 힙 영역의 크기가 늘어난다.
4. 스택 영역 (Stack) : 함수 호출에 따른 지역변수와 매개변수가 저장되는 영역으로, 컴파일 시에 크기가 결정되게 된다. 함수의 호출과 함께 할당되고, 함수의 호출이 종료되면 소멸한다.

### 힙 영역과 스택 영역의 차이점

두 영역은 같은 물리 메모리 공간을 공유하는데 스택은 높은 주소에서 낮은 주소로, 힙은 낮은 주소에서 높은 주소로 채워지기 때문에 서로의 영역을 누가 침범하냐에 따라서 heap, stack overflow가 발생할 수 있다.



### 힙 영역에 대해서

힙 영역은 스택 영역과 다르게 직접 생생된 변수를 제거하는 메모리 관리가 요구된다. 만약 메모리의 힙 영역이 너무 크다면, 넓은 힙 영역에 존재하는 동적 변수에 대해 참조 여부를 확인해야 하기 때문에 GC의 수행 시간이 길어지게 된다. 따라서 Java의 JVM에서도 처음부터 힙 영역을 크게 잡지 않고, 힙이 가득 찼을 때, GC를 진행하고 힙 영역을 확장하게 된다.