<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[JPA] 영속성 컨텍스트 - Jinsu’s story</title>
<meta name="description" content="영속성 컨텍스트">


  <meta name="author" content="Moon JinSu">
  
  <meta property="article:author" content="Moon JinSu">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="Jinsu's story">
<meta property="og:title" content="[JPA] 영속성 컨텍스트">
<meta property="og:url" content="http://localhost:4000/jpa/26/">


  <meta property="og:description" content="영속성 컨텍스트">







  <meta property="article:published_time" content="2023-07-21T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/jpa/26/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "문진수(Moon JinSu)",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Jinsu's story Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Jinsu's story
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Moon JinSu</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>tech blog</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Seoul, Korea</span>
        </li>
      

      
        
          
            <li><a href="mailto:mjinsu098@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/jinsu868" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->

<!-- Categories -->
<nav class="nav__list">
  <ul class="nav__items" id="category_tag_menu">
      <li>
          <span class="nav__sub-title">📂 Total (60)</span>
          <ul>
              
                  
                  <li>
                      <a href="/categories/#spring" class="">Spring (15)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#디자인패턴" class="">디자인패턴 (14)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#java" class="">Java (3)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#알고리즘" class="">알고리즘 (2)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#jpa" class="">JPA (7)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#데이터베이스" class="">데이터베이스 (4)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#network" class="">Network (5)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#클린코드" class="">클린코드 (1)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#git" class="">git (1)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#우테코" class="">우테코 (1)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#테스트" class="">테스트 (2)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#devops" class="">DevOps (1)</a>
                  </li>
                  
              
                  
                  <li>
                      <a href="/categories/#운영체제" class="">운영체제 (5)</a>
                  </li>
                  
              
          </ul>
      </li>
  </ul>
  </nav>

    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[JPA] 영속성 컨텍스트">
    <meta itemprop="description" content="영속성 컨텍스트">
    <meta itemprop="datePublished" content="2023-07-21T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/jpa/26/" class="u-url" itemprop="url">[JPA] 영속성 컨텍스트
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 분 소요
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu"><li><a href="#영속성-컨텍스트">영속성 컨텍스트</a><ul><li><a href="#정의">정의</a></li><li><a href="#엔티티-매니저와-팩토리">엔티티 매니저와 팩토리</a><ul><li><a href="#엔티티-매니저-팩토리-entity-manager-factory">엔티티 매니저 팩토리 (Entity Manager Factory)</a></li><li><a href="#엔티티-매니저-entity-manager">엔티티 매니저 (Entity Manager)</a></li></ul></li><li><a href="#엔티티의-생명주기">엔티티의 생명주기</a><ul><li><a href="#영속">영속</a></li><li><a href="#비영속">비영속</a></li><li><a href="#준영속">준영속</a></li><li><a href="#삭제">삭제</a></li></ul></li><li><a href="#장점">장점</a><ul><li><a href="#1차-캐시">1차 캐시</a></li><li><a href="#동일성">동일성</a></li><li><a href="#쓰기-지연">쓰기 지연</a></li><li><a href="#변경-감지">변경 감지</a></li><li><a href="#지연-로딩">지연 로딩</a></li></ul></li><li><a href="#참고">참고</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <h1 id="영속성-컨텍스트">영속성 컨텍스트</h1>

<h2 id="정의">정의</h2>

<blockquote>
  <p>An EntityManager instance is associated with a persistence context. A persistence context is a set of entity instances in which for any persistent entity identity there is a unique entity instance. Within the persistence context, the entity instances and their lifecycle are managed. The EntityManager API is used to create and remove persistent entity instances, to find entities by their primary key, and to query over entities.</p>
</blockquote>

<p>영속성 컨텍스트는 모든 영속 엔티티 ID에 대해 고유한 엔티티 인스턴스가 있는 엔티티 인스턴의 집합이다. 영속성 컨텍스트에서 각 엔티티 인스턴스와 이들의 생명주기는 관리된다. 엔티티 매니저를 통해서 영속 앤티티를 생성, 제거할 수 있으며 기본키를 사용하여 조회할 수 있다.</p>

<p>영속성 컨텍스트는 모든 엔티티가 DB에서 가져오거나 DB에 저장되는 1차 캐시이다.</p>

<p>쉽게 정리하면 엔티티를 저장하고 관리하는 환경 자체를 말한다. 그리고 애플리케이션과 데이터베이스 사이에서 객체를 보관하며 1차 캐시 역할을 수행한다.</p>

<h2 id="엔티티-매니저와-팩토리">엔티티 매니저와 팩토리</h2>

<p><img src="/assets/images/25_1.png" alt="img1" width="100%&quot;&quot;, height=&quot;40%&quot;" /></p>

<h3 id="엔티티-매니저-팩토리-entity-manager-factory">엔티티 매니저 팩토리 (Entity Manager Factory)</h3>

<p>엔티티 매니저를 생성하는 역할을 수행한다. DB 당 하나만 존재하며 여러 스레드에서 동시에 접근해도 동시성 문제가 발생하지 않는다. JPA 구현체(hibernate 등..)은 앤티티 매니저 팩토리를 생성할 때, 커넥션 풀도 같이 생성해둔다.</p>

<h3 id="엔티티-매니저-entity-manager">엔티티 매니저 (Entity Manager)</h3>

<p>엔티티 매니저는 영속성 컨텍스트에 접근할 수 있는 인터페이스이다. 엔티티 매니저를 통해서 우리가 필요로 하는 연산을 수행할 수 있다. 엔티티 매니저 팩토리와 다르게 thread safe하지 않기 때문에 동시성 문제가 존재한다. 때문에 스레드간 엔티티 매니저를 공유하면 절대 안된다.</p>

<h2 id="엔티티의-생명주기">엔티티의 생명주기</h2>

<p>이제 영속성 컨텍스트에서 관리되는 엔티티들의 생명 주기에 대해서 알아보자.</p>

<p><img src="/assets/images/25_2.png" alt="img1" width="100%&quot;&quot;, height=&quot;40%&quot;" /></p>

<h3 id="영속">영속</h3>

<p>엔티티가 영속성 컨텍스트에서 관리될 때 비로써 연산 결과를 최종적으로 DB에 반영할 수 있다. 이렇게 영속성 컨텍스트에 관리되는 상태를 <strong>영속</strong>상태 라고 한다.</p>

<h3 id="비영속">비영속</h3>

<p>영속성 컨텍스트와 전혀 관련이 없는 상태를 말한다. 이 상태의 엔티티는 값이 변경되거나, 삭제되더라도 DB에 반영되지 않는다.</p>

<h3 id="준영속">준영속</h3>

<p>영속성 컨텍스트에서 관리되다가 분리된 상태를 말한다. 비영속과 마찬가지로 엔티티가 변경되도 DB에 반영되지 않는다.</p>

<h3 id="삭제">삭제</h3>

<p>영속성 컨텍스트로부터 삭제된 상태를 말한다.</p>

<p>지금까지 영속성 컨텍스트에서 관리되는 엔티티들의 생명주기에 대해서 알아봤다. 그렇다면 영속성 컨텍스트에 관리되면 어떤 이점이 있을까?</p>

<p>이제 이에 대해서 알아보자.</p>

<h2 id="장점">장점</h2>

<h3 id="1차-캐시">1차 캐시</h3>

<p>앞에 영속성 컨텍스트 정의에서 설명했듯이 영속성 컨텍스트는 애플리케이션과 DB사이에서 1차 캐시 역할을 수행한다. 만약 영속성 컨텍스트에 조회하고자 하는 데이터가 있다면 DB를 거치지 않고도 값을 읽어올 수 있기 때문에 약간의 성능 향상이 있을 수 있다.</p>

<h3 id="동일성">동일성</h3>

<p>영속성 컨텍스트는 1차 캐시로서 REPEATABLE READ 등급의 트랜잭션 격리 수준을 애플리케이션 차원에서 제공해준다. (트랜잭션 격리 수준에 대해서 잘 모른다면 <a href="https://jinsu868.github.io/데이터베이스/47">참고</a>을 참고하자.)</p>

<h3 id="쓰기-지연">쓰기 지연</h3>

<p>만약 트랜잭션 안에서 모든 연산마다 DB에 쿼리가 하나씩 나간다면 어떨까? 분명 성능이 좋지 못할 것이다. 영속성 컨텍스트는 트랜잭션 안에서 수행되는 연산들을 쓰기 지연 SQL 저장소에 모아두었다가 <code class="language-plaintext highlighter-rouge">flush()</code>가 호출되면 한번에 DB에 쿼리를 보낸다.</p>

<h3 id="변경-감지">변경 감지</h3>

<p>영속성 컨텍스트는 처음 1차 캐시에 엔티티를 저장하는 시점의 엔티티의 상태를 스냅샷으로 저장해둔다. 그리고 <code class="language-plaintext highlighter-rouge">flush()</code>가 호출될 때 현재 상태와 스냅샷을 비교하여 변경된 부분을 쿼리로 생성하고 DB에 한번에 쿼리를 보낸다. 때문에 개발자가 변경된 부분에 대한 수정 쿼리를 일일이 작성할 필요가 없다.</p>

<h3 id="지연-로딩">지연 로딩</h3>

<p>지연 로딩 세팅을 해두면 엔티티를 사용하기 전까지는 proxy 객체를 대신 넣어두게 된다. 때문에 실제로 엔티티가 사용되기 전까지 DB에 쿼리를 보내지 않고 실제 사용 시점에 쿼리를 보내게 된다.</p>

<h2 id="참고">참고</h2>

<ul>
  <li>
    <p><a href="https://www.inflearn.com/course/ORM-JPA-Basic/dashboard">자바 ORM 표준 JPA 프로그래밍</a></p>
  </li>
  <li>
    <p><a href="https://www.baeldung.com/jpa-hibernate-persistence-context">https://www.baeldung.com/jpa-hibernate-persistence-context</a></p>
  </li>
</ul>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#jpa" class="page__taxonomy-item p-category" rel="tag">JPA</a><span class="sep">, </span>
    
      <a href="/tags/#spring" class="page__taxonomy-item p-category" rel="tag">Spring</a><span class="sep">, </span>
    
      <a href="/tags/#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4" class="page__taxonomy-item p-category" rel="tag">데이터베이스</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#jpa" class="page__taxonomy-item p-category" rel="tag">JPA</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time class="dt-published" datetime="2023-07-21T00:00:00+09:00">July 21, 2023</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <a href="https://twitter.com/intent/tweet?text=%5BJPA%5D+%EC%98%81%EC%86%8D%EC%84%B1+%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%20http%3A%2F%2Flocalhost%3A4000%2Fjpa%2F26%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fjpa%2F26%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fjpa%2F26%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/unionFind/" class="pagination--pager" title="[알고리즘] Union find
">이전</a>
    
    
      <a href="/jpa/JPA1/" class="pagination--pager" title="[JPA] ORM 이란?
">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">참고</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/60/" rel="permalink">[운영체제] 프로세스 스케줄링
</a>
      
    </h2>

    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> January 10 2024</p>
    

    <!-- 

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 분 소요
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">CPU 스케줄링
</p> -->
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/59/" rel="permalink">[운영체제] 프로세스 동기화
</a>
      
    </h2>

    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> January 09 2024</p>
    

    <!-- 

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 분 소요
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">프로세스 동기화에 대해서 이해하기 위해서는 우선 임계 영역과 경쟁 상태에 대해서 이해해야 한다. 차례대로 살펴보며 이해해보자.
</p> -->
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/58/" rel="permalink">[운영체제] 스레드
</a>
      
    </h2>

    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> January 09 2024</p>
    

    <!-- 

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 분 소요
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">스레드
</p> -->
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/57/" rel="permalink">[운영체제] 좀비 프로세스 vs 고아 프로세스
</a>
      
    </h2>

    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> January 08 2024</p>
    

    <!-- 

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 분 소요
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">좀비 프로세스와 고아 프로세스를 이해하기 위해서 먼저 프로세스를 생성하는 과정을 좀 더 자세하게 알아보자.
</p> -->
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
          <li><a href="mailto:mjinsu098@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://github.com/jinsu868" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 문진수(Moon JinSu). Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
